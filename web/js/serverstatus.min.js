function timeSince(e){if(0==e)return"从未";var r=Math.floor((new Date-e)/1e3),s=Math.floor(r/31536e3);return s>1?s+" 年前":(s=Math.floor(r/2592e3),s>1?s+" 月前":(s=Math.floor(r/86400),s>1?s+" 日前":(s=Math.floor(r/3600),s>1?s+" 小时前":(s=Math.floor(r/60),s>1?s+" 分钟前":"几秒前"))))}function bytesToSize(e,r,s){var i;if(s="undefined"!=typeof s?s:0,0!=s)var n=1e3,t=1e3*n,d=1e3*t,l=1e3*d;else var n=1024,t=1024*n,d=1024*t,l=1024*d;if(e>=0&&e<n)return e+" B";if(e>=n&&e<t)i=(e/n).toFixed(r)+" K";else if(e>=t&&e<d)i=(e/t).toFixed(r)+" M";else if(e>=d&&e<l)i=(e/d).toFixed(r)+" G";else{if(!(e>=l))return e+" B";i=(e/l).toFixed(r)+" T"}return 0!=s?i+"B":i+"iB"}function uptime(){$.getJSON("json/stats.json",function(e){$("#loading-notice").remove(),e.reload&&setTimeout(function(){location.reload(!0)},1e3);for(var r=0,s=e.servers.length;r<s;r++){var i,n=$("#servers tr#r"+r),t=$("#servers #rt"+r);if(i=r%2?"odd":"even",n.length||($("#servers").append('<tr id="r'+r+'" data-toggle="collapse" data-target="#rt'+r+'" class="accordion-toggle '+i+'"><td id="online4"><div class="progress"><div style="width: 100%;" class="progress-bar progress-bar-warning"><small>加载中</small></div></div></td><td id="online6"><div class="progress"><div style="width: 100%;" class="progress-bar progress-bar-warning"><small>加载中</small></div></div></td><td id="name">加载中</td><td id="type">加载中</td><td id="host">加载中</td><td id="location">加载中</td><td id="uptime">加载中</td><td id="load">加载中</td><td id="network">加载中</td><td id="traffic">加载中</td><td id="cpu"><div class="progress progress-striped active"><div style="width: 100%;" class="progress-bar progress-bar-warning"><small>加载中</small></div></div></td><td id="memory"><div class="progress progress-striped active"><div style="width: 100%;" class="progress-bar progress-bar-warning"><small>加载中</small></div></div></td><td id="hdd"><div class="progress progress-striped active"><div style="width: 100%;" class="progress-bar progress-bar-warning"><small>加载中</small></div></div></td></tr><tr class="expandRow '+i+'"><td colspan="16"><div class="accordian-body collapse" id="rt'+r+'"><div id="expand_mem">加载中</div><div id="expand_swap">加载中</div><div id="expand_hdd">加载中</div><div id="expand_custom">加载中</div></div></td></tr>'),n=$("#servers tr#r"+r),t=$("#servers #rt"+r),server_status[r]=!0),n=n[0],error&&(n.setAttribute("data-target","#rt"+r),server_status[r]=!0),e.servers[r].online4?(n.children.online4.children[0].children[0].className="progress-bar progress-bar-success",n.children.online4.children[0].children[0].innerHTML="<small>开启</small>"):(n.children.online4.children[0].children[0].className="progress-bar progress-bar-danger",n.children.online4.children[0].children[0].innerHTML="<small>关闭</small>"),e.servers[r].online6?(n.children.online6.children[0].children[0].className="progress-bar progress-bar-success",n.children.online6.children[0].children[0].innerHTML="<small>开启</small>"):(n.children.online6.children[0].children[0].className="progress-bar progress-bar-danger",n.children.online6.children[0].children[0].innerHTML="<small>关闭</small>"),n.children.name.innerHTML=e.servers[r].name,n.children.type.innerHTML=e.servers[r].type,n.children.location.innerHTML=e.servers[r].location,e.servers[r].online4||e.servers[r].online6){if(server_status[r]||(n.setAttribute("data-target","#rt"+r),server_status[r]=!0),n.children.uptime.innerHTML=e.servers[r].uptime,e.servers[r].load==-1)n.children.load.innerHTML="–";else{var l="";l+=e.servers[r].load_1.toFixed(2),l+=" | ",l+=e.servers[r].load_5.toFixed(2),l+=" | ",l+=e.servers[r].load_15.toFixed(2),n.children.load.innerHTML=l}var a="";a+=e.servers[r].network_rx<1e3?e.servers[r].network_rx.toFixed(0)+"B":e.servers[r].network_rx<1e6?(e.servers[r].network_rx/1e3).toFixed(0)+"K":(e.servers[r].network_rx/1e3/1e3).toFixed(1)+"M",a+=" | ",a+=e.servers[r].network_tx<1e3?e.servers[r].network_tx.toFixed(0)+"B":e.servers[r].network_tx<1e6?(e.servers[r].network_tx/1e3).toFixed(0)+"K":(e.servers[r].network_tx/1e3/1e3).toFixed(1)+"M",n.children.network.innerHTML=a;var o="";o+=e.servers[r].network_in<1024?e.servers[r].network_in.toFixed(0)+"B":e.servers[r].network_in<1048576?(e.servers[r].network_in/1024).toFixed(0)+"K":e.servers[r].network_in<1073741824?(e.servers[r].network_in/1024/1024).toFixed(1)+"M":e.servers[r].network_in<1099511627776?(e.servers[r].network_in/1024/1024/1024).toFixed(2)+"G":(e.servers[r].network_in/1024/1024/1024/1024).toFixed(2)+"T",o+=" | ",o+=e.servers[r].network_out<1024?e.servers[r].network_out.toFixed(0)+"B":e.servers[r].network_out<1048576?(e.servers[r].network_out/1024).toFixed(0)+"K":e.servers[r].network_out<1073741824?(e.servers[r].network_out/1024/1024).toFixed(1)+"M":e.servers[r].network_out<1099511627776?(e.servers[r].network_out/1024/1024/1024).toFixed(2)+"G":(e.servers[r].network_out/1024/1024/1024/1024).toFixed(2)+"T",n.children.traffic.innerHTML=o,e.servers[r].cpu>=90?n.children.cpu.children[0].children[0].className="progress-bar progress-bar-danger":e.servers[r].cpu>=80?n.children.cpu.children[0].children[0].className="progress-bar progress-bar-warning":n.children.cpu.children[0].children[0].className="progress-bar progress-bar-success",n.children.cpu.children[0].children[0].style.width=e.servers[r].cpu+"%",n.children.cpu.children[0].children[0].innerHTML=e.servers[r].cpu+"%";var c=(e.servers[r].memory_used/e.servers[r].memory_total*100).toFixed(0);c>=90?n.children.memory.children[0].children[0].className="progress-bar progress-bar-danger":c>=80?n.children.memory.children[0].children[0].className="progress-bar progress-bar-warning":n.children.memory.children[0].children[0].className="progress-bar progress-bar-success",n.children.memory.children[0].children[0].style.width=c+"%",n.children.memory.children[0].children[0].innerHTML=c+"%",t[0].children.expand_mem.innerHTML="内存信息: "+bytesToSize(1024*e.servers[r].memory_used,2)+" / "+bytesToSize(1024*e.servers[r].memory_total,2),t[0].children.expand_swap.innerHTML="交换分区: "+bytesToSize(1024*e.servers[r].swap_used,2)+" / "+bytesToSize(1024*e.servers[r].swap_total,2);var h=(e.servers[r].hdd_used/e.servers[r].hdd_total*100).toFixed(0);h>=90?n.children.hdd.children[0].children[0].className="progress-bar progress-bar-danger":h>=80?n.children.hdd.children[0].children[0].className="progress-bar progress-bar-warning":n.children.hdd.children[0].children[0].className="progress-bar progress-bar-success",n.children.hdd.children[0].children[0].style.width=h+"%",n.children.hdd.children[0].children[0].innerHTML=h+"%",t[0].children.expand_hdd.innerHTML="硬盘信息: "+bytesToSize(1024*e.servers[r].hdd_used*1024,2)+" / "+bytesToSize(1024*e.servers[r].hdd_total*1024,2),e.servers[r].custom?t[0].children.expand_custom.innerHTML=e.servers[r].custom:t[0].children.expand_custom.innerHTML=""}else server_status[r]&&(n.children.uptime.innerHTML="–",n.children.load.innerHTML="–",n.children.network.innerHTML="–",n.children.traffic.innerHTML="–",n.children.cpu.children[0].children[0].className="progress-bar progress-bar-danger",n.children.cpu.children[0].children[0].style.width="100%",n.children.cpu.children[0].children[0].innerHTML="<small>关闭</small>",n.children.memory.children[0].children[0].className="progress-bar progress-bar-danger",n.children.memory.children[0].children[0].style.width="100%",n.children.memory.children[0].children[0].innerHTML="<small>关闭</small>",n.children.hdd.children[0].children[0].className="progress-bar progress-bar-danger",n.children.hdd.children[0].children[0].style.width="100%",n.children.hdd.children[0].children[0].innerHTML="<small>关闭</small>",t.hasClass("in")&&t.collapse("hide"),n.setAttribute("data-target",""),server_status[r]=!1)}d=new Date(1e3*e.updated),error=0}).fail(function(e){error||$("#servers > tr.accordion-toggle").each(function(e){var r=$("#servers tr#r"+e)[0],s=$("#servers #rt"+e);r.children.online4.children[0].children[0].className="progress-bar progress-bar-error",r.children.online4.children[0].children[0].innerHTML="<small>错误</small>",r.children.online6.children[0].children[0].className="progress-bar progress-bar-error",r.children.online6.children[0].children[0].innerHTML="<small>错误</small>",r.children.uptime.innerHTML='<div class="progress progress-striped active"><div style="width: 100%;" class="progress-bar progress-bar-error"><small>错误</small></div></div>',r.children.load.innerHTML='<div class="progress progress-striped active"><div style="width: 100%;" class="progress-bar progress-bar-error"><small>错误</small></div></div>',r.children.network.innerHTML='<div class="progress progress-striped active"><div style="width: 100%;" class="progress-bar progress-bar-error"><small>错误</small></div></div>',r.children.traffic.innerHTML='<div class="progress progress-striped active"><div style="width: 100%;" class="progress-bar progress-bar-error"><small>错误</small></div></div>',r.children.cpu.children[0].children[0].className="progress-bar progress-bar-error",r.children.cpu.children[0].children[0].style.width="100%",r.children.cpu.children[0].children[0].innerHTML="<small>错误</small>",r.children.memory.children[0].children[0].className="progress-bar progress-bar-error",r.children.memory.children[0].children[0].style.width="100%",r.children.memory.children[0].children[0].innerHTML="<small>错误</small>",r.children.hdd.children[0].children[0].className="progress-bar progress-bar-error",r.children.hdd.children[0].children[0].style.width="100%",r.children.hdd.children[0].children[0].innerHTML="<small>错误</small>",s.hasClass("in")&&s.collapse("hide"),r.setAttribute("data-target",""),server_status[e]=!1}),error=1,$("#updated").html("更新错误")})}function updateTime(){error||$("#updated").html("最后更新: "+timeSince(d))}function setActiveStyleSheet(e){var r,s;for(r=0;s=document.getElementsByTagName("link")[r];r++)s.getAttribute("rel").indexOf("style")!=-1&&s.getAttribute("title")&&(s.disabled=!0,s.getAttribute("title")==e&&(s.disabled=!1))}function getActiveStyleSheet(){var e,r;for(e=0;r=document.getElementsByTagName("link")[e];e++)if(r.getAttribute("rel").indexOf("style")!=-1&&r.getAttribute("title")&&!r.disabled)return r.getAttribute("title");return null}function getPreferredStyleSheet(){var e,r;for(e=0;r=document.getElementsByTagName("link")[e];e++)if(r.getAttribute("rel").indexOf("style")!=-1&&r.getAttribute("rel").indexOf("alt")==-1&&r.getAttribute("title"))return r.getAttribute("title");return null}function createCookie(e,r,s){if(s){var i=new Date;i.setTime(i.getTime()+24*s*60*60*1e3);var n="; expires="+i.toGMTString()}else n="";document.cookie=e+"="+r+n+"; path=/"}function readCookie(e){for(var r=e+"=",s=document.cookie.split(";"),i=0;i<s.length;i++){for(var n=s[i];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(r))return n.substring(r.length,n.length)}return null}var error=0,d=0,server_status=new Array;uptime(),updateTime(),setInterval(uptime,2e3),setInterval(updateTime,500),window.onload=function(e){var r=readCookie("style"),s=r?r:getPreferredStyleSheet();setActiveStyleSheet(s)},window.onunload=function(e){var r=getActiveStyleSheet();createCookie("style",r,365)};var cookie=readCookie("style"),title=cookie?cookie:getPreferredStyleSheet();setActiveStyleSheet(title);